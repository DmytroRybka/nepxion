package com.nepxion.util.io;

/**
 * <p>Title: Nepxion Utility</p>
 * <p>Description: Nepxion Utility Repository</p>
 * <p>Copyright: Copyright (c) 2010</p>
 * <p>Company: Nepxion</p>
 * @author Neptune
 * @email hj_ren@msn.com
 * @version 1.0
 */

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;

public class FileUtil
{		
	/**
	 * Transfer String to InputSteam
	 * @param content  the instance of String
	 * @return         the instance of InputStream
	 */
	public static InputStream transfer(String content)
	{
		InputStream bais = new ByteArrayInputStream(content.getBytes());	
		return bais;
	}
	
	/**
	 * Transfer InputSteam to String
	 * @param content  the instance of InputStream
	 * @return         the instance of String
	 */	
	public static String transfer(InputStream inputStream)
		throws IOException
	{
		if (inputStream == null)
		{
			return "";
		}
		
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		int index = -1;
		while ((index = inputStream.read()) != -1)
		{
			baos.write(index);
		}
		
		inputStream.close();
		baos.close();	
		
		return baos.toString(); 
	}
	
	/**
	 * Transfer InputSteam to String
	 * @param content   the instance of InputStream
	 * @param encoding  the encoding content, example "UTF-8", "GBK", "GB2321"
	 * @return          the instance of String
	 */	
	public static String transfer(InputStream inputStream, String encoding)
		throws IOException
	{
		if (inputStream == null)
		{
			return "";
		}
		
	    StringBuffer stringBuffer = new StringBuffer();
		InputStreamReader inputStreamReader = new InputStreamReader(inputStream, encoding);
		
		char[] bytes = new char[4096];
		int index = -1;
		while ((index = inputStreamReader.read(bytes)) != -1)
		{
			stringBuffer.append(new String(bytes, 0, index));
		}
		
		inputStream.close();
		inputStreamReader.close();
		
		return stringBuffer.toString();		
	}	
	
	/**
	 * Read the file string.If an exception is caught,the method will return the exception for a string format
	 * @param filePath  the file path
	 * @return          the file string or exception string
	 */	
	public static String read(String filePath)
	{
		return read(filePath, null, false);
	}	
	
	/**
	 * Read the file string.If an exception is caught,the method will return the exception for a string format
	 * @param filePath     the file path
	 * @param classLoader  the flag whether the inputStream is generated by classLoader
	 * @return             the file string or exception string
	 */		
	public static String read(String filePath, boolean classLoader)
	{
		return read(filePath, null, classLoader);
	}	
	
	/**
	 * Read the file string.If an exception is caught,the method will return the exception for a string format
	 * @param filePath  the file path
	 * @param encoding  the encoding content, example "GB2321", "UTF-8"
	 * @return          the file string or exception string
	 */	
	public static String read(String filePath, String encoding)
	{
		return read(filePath, encoding, false);
	}
	
	/**
	 * Read the file string.If an exception is caught,the method will return the exception for a string format
	 * @param filePath     the file path
	 * @param encoding     the encoding content, example "GB2321", "UTF-8"
	 * @param classLoader  the flag whether the inputStream is generated by classLoader
	 * @return             the file string or exception string
	 */
	public static String read(String filePath, String encoding, boolean classLoader)
	{
		String content = "";
		try
		{
			InputStream inputStream = null;
			if (classLoader)
			{
				inputStream = FileUtil.class.getClassLoader().getResourceAsStream(filePath);
			}
			else
			{
				inputStream = new FileInputStream(filePath);
			}
			
			if (encoding != null)
			{	
				content = transfer(inputStream, encoding);
			}
			else
			{
				content = transfer(inputStream);
			}
		}
		catch (FileNotFoundException e)
		{
			e.printStackTrace();
			content = e.toString();
		}
		catch (IOException e)
		{
			e.printStackTrace();
			content = e.toString();
		}
		return content;
	}
	
	/**
	 * Write the file string.If an exception is caught,the method will return the exception for a string format
	 * @param content   the file content
	 * @param filePath  the file path
	 * @return          exception string or empty string
	 */
	public static String write(String content, String filePath)
	{
		try
		{
			OutputStream outputStream = new FileOutputStream(filePath);
			byte[] b = content.trim().getBytes();
			outputStream.write(b);
			outputStream.close();			
		}
		catch (FileNotFoundException e)
		{
			e.printStackTrace();
			return e.toString();
		}
		catch (IOException e)
		{
			e.printStackTrace();
			return e.toString();
		}
		return "";
	}
	
	/**
	 * Get the code resource path
	 * @param c                  the instance of Class
	 * @param projectFolderName  the project folder name
	 * @return                   the code resource path        
	 */
	public static String getCodePath(Class c, String projectFolderName)
	{
		return getCodePath(c, projectFolderName, "src");
	}
	
	/**
	 * Get the code resource path
	 * @param c                   the instance of Class
	 * @param projectFolderName   the project folder name
	 * @param resourceFolderName  the source folder name
	 * @return                    the code resource path        
	 */	
	public static String getCodePath(Class c, String projectFolderName, String resourceFolderName)
	{
		String classPath = c.getName();
		classPath = classPath.replace('.', '/') + ".java";
		
		String resourcePath = c.getClassLoader().getResource("").getPath();
		resourcePath = resourcePath.substring(1);
		resourcePath = resourcePath.substring(0, resourcePath.indexOf(projectFolderName) + projectFolderName.length());
		resourcePath = resourcePath + "/" + resourceFolderName + "/";
		
		String codePath = resourcePath + classPath;
		return codePath;
	}
}